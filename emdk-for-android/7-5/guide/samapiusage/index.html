
<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="-1">
    <meta http-equiv="CACHE-CONTROL" content="NO-CACHE">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Online Documentation for Zebra Technologies developer tools and utilties, including EMDK for Android, EMDK for Xamarin, StageNow and Enterprise Browser.">
    <meta name="author" content="Zebra Technologies">
    <meta name="google-site-verification" content="i4B78BrWnNy8ShJwe5feRW3jO3HE6gfYlYqYbxfl8yY">
    <meta name="msvalidate.01" content="6B651B00161BCE79B8950AC09D5C4C75">
    <meta title="SAM API Programmer's Guide">
    <title>SAM API Programmer's Guide - TechDocs</title>
    <!-- core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
<!--     
    <link href="/css/font-awesome.min.css" rel="stylesheet">
 -->    
    <link href="/css/all.css" rel="stylesheet">
    <link href="/css/v4-shims.css" rel="stylesheet">
    <link href="/css/animate.min.css" rel="stylesheet">
    <link href="/css/owl.carousel.css" rel="stylesheet">
    <link href="/css/owl.transitions.css" rel="stylesheet">
    <link href="/css/prettyPhoto.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">
    <link href="/css/responsive.css" rel="stylesheet">
    <link href="/css/prettify.css" rel="stylesheet">
    <link href="/css/bootstrap-treenav.min.css" rel="stylesheet">
    <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]--> 

    <script src="//load.sumome.com/" data-sumo-site-id="699cb66cf4dc59352efb45705526d15cbe314e1cd43f7761b94d96f3cf7338e8" async="async"></script>
    <link rel="shortcut icon" href="/favicon.ico">
<script src="/js/jquery.js"></script></head><!--/head-->


<body id="home" class="homepage" data-spy="scroll" data-offset="100" data-target="#toc">

    <header id="header">
        <nav id="main-menu" class="navbar navbar-default navbar-fixed-top" role="banner">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/"><img src="/images/logo.png" alt="logo" style="max-height:66px;float: inherit;
    padding-right: 3px;"></a> 
                    
                   
                </div>
                <div class="collapse navbar-collapse navbar-left">
                    <ul class="nav navbar-nav">
                        <li class="navbar-text pull-left"><strong>TechDocs</strong></li>
                        <li class="dropdown">
                          <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown"> EMDK For Android 7.5
                          <span class="caret"></span></button>
                          <ul class="dropdown-menu">
                                <li><a onclick="changeVersion('5-0','4-2','/emdk-for-android/4-2/guide/about')">EMDK For Android 4.2</a></li>
                                <li><a onclick="changeVersion('5-0','4-0','/emdk-for-android/4-0/guide/about')">EMDK For Android 4.0</a></li>
                          </ul>
                        </li>                    
                    </ul>
                </div>
                <div class="collapse navbar-collapse navbar-right">
                    <ul class="nav navbar-nav">
                        


                        <li>
                            <a href="/emdk-for-android/7-5/guide/about">
                                    About
                            </a>
                        </li>
                        <li>
                            <a href="/emdk-for-android/7-5/guide/gettingstarted">
                                    Get Started
                            </a>
                        </li>
                        <li>
                            <a href="/emdk-for-android/7-5/tutorial/">
                                    Tutorials
                            </a>
                        </li>
                        <li>
                            <a href="/emdk-for-android/7-5/samples">
                                    Samples
                            </a>
                        </li>
                        <li>
                            <a href="/emdk-for-android/7-5/guide/programming-guides">
                                    Guides
                            </a>
                        </li>
                        <li>
                            <a href="/emdk-for-android/7-5/guide/profile-manager-guides">
                                    Profile Manager
                            </a>
                        </li>
                        <li>
                            <a href="/emdk-for-android/7-5/faq">
                                    FAQs
                            </a>
                        </li>
                        <li>
                            <a href="/emdk-for-android/7-5/apimenu">
                                    APIs
                            </a>
                        </li>
                        <li>
                            <a href="https://developer.zebra.com/forum/search?keys=&amp;field_zebra_curated_tags_tid%5B%5D=184">
                                    <i class="fa fa-comments-o"></i>
                            </a>
                        </li>
                        <li>
                            <a href="/emdk-for-android/7-5/search">
                                    <i class="fa fa-search"></i>
                            </a>
                        </li>
                        
                        <!-- <li ><a href="/products">SDKs</a></li>
                        <li ><a href="/samples">Samples</a></li>
                        <li ><a href="/guides">Guides</a></li>
                        <li ><a href="/tutorials">Tutorials</a></li>
                        <li ><a href="/apis">APIs</a></li> -->
                        <!-- <li><a href="#"><input type="text" class="st-default-search-input"></a></li> -->
                    </ul>
                </div>
            </div><!--/.container-->
        </nav><!--/nav-->
    </header><!--/header-->
<div class="container-fluid">
    <section id="blog">
        <div class="">
            <section class="content-with-sidebar">
            <div class="row">
                <div class="col-sm-12 ">

                    <div id="mainContent" class="row">
                        <div class="col-sm-12">
                            <div class="blog-post blog-large wow fadeInLeft" data-wow-duration="300ms" data-wow-delay="0ms">
                            <!-- Start of guide -->
                                <div class="service-box wow fadeInRight">
                                    <div class="">

<!--                         <p><h2 id="overview">Overview</h2>

<p>The EMDK for Android Secure Access Module (SAM) API provides developers with a comprehensive set of tools to easily create secure NFC applications for use with Zebra mobile devices. It's important to note that <strong>the EMDK SAM API allows only for secure communication with the NFC tags</strong>. The SAMManager is the primary object used to enumerate available SAMs and access SAMs to securely communicate with tags. Applications should use the Android NFC APIs to read standard NFC tags. </p>

<hr />

<h3 id="updateandroidmanifest">Update Android Manifest</h3>

<p>&#49;. Add the following permissions in the Android Manifest:</p>

<pre><code>    :::xml
    &lt;uses-permission android:name="com.symbol.emdk.permission.EMDK"/&gt;
    &lt;uses-permission android:name="android.permission.NFC" /&gt;
</code></pre>

<p>&#50;. In the manifest's &lt;application&gt; node, add the following line to enable use of EMDK libraries on the device:</p>

<pre><code>    :::xml 
    &lt;uses-library android:name="com.symbol.emdk"/&gt;
</code></pre>

<p>&#51;. Determine whether NFC is supported by the device by running the following code:</p>

<pre><code>    :::Java
    if (NfcAdapter.getDefaultAdapter(this) == null) { 
        Toast.makeText(this, "NFC Not Supported", Toast.LENGTH_SHORT).show();
        finish();
        return;
    }
</code></pre>

<p>If NFC is supported, continue to the next step.</p>

<hr />

<h3 id="getthesammanager">Get the SAM Manager</h3>

<p>An EMDK Manager object must be acquired before getting the SAM Manager object, and must release the SAM Manager class before quitting. Use the code below to get the SAM Manager: </p>

<pre><code>    :::Java
    samManager = (SAMManager) emdkManager.getInstance(EMDKManager.FEATURE_TYPE.SAM);
</code></pre>

<hr />

<h3 id="enumeratesamobjects">Enumerate SAM Objects</h3>

<p>The <code>enumerateSAMs()</code> call returns a list of SAM objects present in the device. An empty list indicates that no SAMs are present. Call the <code>enumerateSAMs()</code> method to enumerate the available SAMs in the device: </p>

<pre><code>    :::Java
    List&lt;SAM&gt; samList = null;
    try {
        samList = samManager.enumerateSAMs();
    }catch (SAMException ex){
        Log.d(TAG, SAMResults.getErrorDescription(ex.getResult()));
    }
    if(samList != null &amp;&amp; samList.size()&gt;0) {
        SAM sam = samList.get(0);
    }
</code></pre>

<hr />

<h3 id="usingthesam">Using the SAM</h3>

<p>To use a SAM, a connection must be made with the SAM. Zebra recommends disconnecting the SAM when communications are concluded.</p>

<p>&#49;. Get SAM type: </p>

<pre><code>    :::Java
    getSAMType() //returns the SAM type (i.e. MIFARE, CALYPSO, FELICA)

    SAMType samType = sam.getSamType();
</code></pre>

<p>&#50;. Use the <code>connect()</code> method to connect to a SAM:</p>

<pre><code>    :::Java
    if (!sam.isConnected()) {
        try {
            sam.connect();
        } catch (SAMException ex) {
            Log.d(TAG, SAMResults.getErrorDescription(ex.getResult()));
            return;
        }
    }
</code></pre>

<h4 id="notes">Notes</h4>

<ul>
<li>If another SAM is already connected, <code>connect()</code> throws and exception.</li>

<li>The <code>isConnected()</code> method returns the current SAM connection status.</li>

<li>Exceptions will be thrown if: 


<ul>
<li>The called SAM is already connected with the current application</li>

<li>Another SAM connected with the current application </li>

<li>A different app is connected to the SAM</li></ul>
</li>
</ul>

<hr />

<h3 id="transceiveapi">Transceive API</h3>

<p>The basic unit of communication between an NFC reader and a tag is the Application Protocol Data Unit, or APDU. Use the <code>transceive()</code> method is used to send the APDUs to the SAM. </p>

<p><strong>To send an ADPU</strong>: </p>

<pre><code>    :::Java 
    byte[] getVersionAPDU = new byte[]{(byte) 0x80, (byte) 0x60, (byte) 0x00, (byte) 0x00,/*(byte)0x00,*/(byte) 0x00};
    byte[] response = null;
    try {
        response = sam.transceive(getVersionAPDU, (short) 0, false);
    } catch (SAMException  ex) {
        Log.d(TAG,SAMResults.getErrorDescription(ex.getResult()));
    }
</code></pre>

<h4 id="notes-1">Notes</h4>

<ul>
<li>Exceptions will be thrown if:


<ul>
<li>SAM is not connected    </li>

<li>A SAM is having an active connection by a different application</li>

<li>Failure to transceive data</li></ul>
</li>
</ul>

<hr />

<h3 id="disconnectsam">Disconnect SAM</h3>

<p>Use the <code>disconnect()</code> method to close the SAM connection. The SAM must be closed after all communications are done. Failure to do so might prevent other apps from using SAM APIs.</p>

<p><strong>To disconnect SAM</strong>: </p>

<pre><code>:::Java
if (sam.isConnected()) {
    sam.disconnect();
}
</code></pre>

<h3 id="getsamindex">Get SAM Index</h3>

<p>The <code>getSamIndex()</code> method returns the slot index of the SAM starting from 1.</p>

<p><strong>To get the SAM slot index</strong>:  </p>

<pre><code>:::Java
int index = sam.getSamIndex();
</code></pre>

<hr />

<h3 id="detectnfctag">Detect NFC Tag</h3>

<p>The sample code below shows how to use <a href="https://developer.android.com/guide/topics/connectivity/nfc/nfc">Android NFC APIs</a> to detect an NFC tag and establish a connection with an appropriate SAM using the EMDK SAM API's <code>connect()</code> method. </p>

<h4 id="samplecode">Sample Code</h4>

<pre><code>public class MainActivity extends AppCompatActivity implements EMDKManager.EMDKListener {

    ...

    boolean tagOperationInProgress = false;
    private PendingIntent nfcIntent = null;
    private NfcAdapter nfcAdapter = null;
    private String detectedTag = "";

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

    ...

        nfcIntent = PendingIntent.getActivity(this, 0,
                new Intent(this, this.getClass())
                        .addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP), 0);

    }
    @Override
    protected void onResume() {
        super.onResume();

        ...

        if(tagOperationInProgress)
            tagOperationInProgress = false;

        if (nfcAdapter != null) {
            nfcAdapter.enableForegroundDispatch(this, nfcIntent, null, null);
        }
    }

    @Override
    protected void onPause() {
        super.onPause();

        ...

        if(nfcAdapter!=null){
            nfcAdapter.disableForegroundDispatch(this);
        }
    }

    @Override
    protected void onNewIntent(Intent intent) {
        super.onNewIntent(intent);
        tagDetection(intent);
    }

    private void tagDetection(Intent intent) {

        tagOperationInProgress = true;

        if(samManager == null) {
            //initSAMManager();
        }

        if (NfcAdapter.ACTION_NDEF_DISCOVERED.equals(intent.getAction())
                || NfcAdapter.ACTION_TAG_DISCOVERED.equals(intent.getAction())
                || NfcAdapter.ACTION_TECH_DISCOVERED.equals(intent.getAction())) {

            Tag lTag = intent.getParcelableExtra(NfcAdapter.EXTRA_TAG);
            SAM sam = null;
            SAMType samTypeForTag = null;

            samTypeForTag = findCompatibleSAM(lTag);

            String text = detectedTag + " " + getString(R.string.message_tag_detected) + "\n";

            String compatibeSAMText = "";
            for (Map.Entry&lt;Integer, SAM&gt; entry : presetSAMList.entrySet())
            {
                if(entry.getValue().getSamType() == samTypeForTag)
                {
                    sam = entry.getValue();
                    compatibeSAMText += "\n\t" + sam.getSamType() + "(Slot " + sam.getSamIndex() + ")";
                }
            }
            if(!presetSAMList.isEmpty()) {
                if (!compatibeSAMText.isEmpty()) {

                    text += getString(R.string.message_tag_compatible) + " " + compatibeSAMText;

                    /**
                     * Connect to the appropriate SAM based on the Tag detected.
                     *
                    /** Connect [Start] 
                    try {
                        if (!sam.isConnected()) {
                            sam.connect();
                        }
                    } catch (SAMException ex) {
                      SAMResults.getErrorDescription(ex.getResult());
                    }
                    /** Connect [End] */

                    /** Transceive [Start]
                    byte[] response = null;
                    try {
                        response = sam.transceive(transceive_apdu_1, (short) 0, false);
                        response = sam.transceive(transceive_apdu_2, (short) 0, false);
                        response = sam.transceive(transceive_apdu_3, (short) 0, false);
                        response = sam.transceive(transceive_apdu_4, (short) 0, false);
                    } catch (SAMException ex) {
                       SAMResults.getErrorDescription(ex.getResult());
                    }
                    /**Transceive [End] */

                    /** Disconnect [Start]
                    if (sam.isConnected()) {
                        sam.disconnect();
                    }
                    /** Disconnect [End] */

                } else {
                    text += getString(R.string.message_tag_not_compatible);
                }
            }
        }
    }
    private SAMType findCompatibleSAM(Tag aTag) {

            /**
           Refer to link below for documentation describing how to identify 
           card tag type and how to return the matching SAMType
           https://developer.android.com/guide/topics/connectivity/nfc/nfc 
            */
    }
}
</code></pre></p>
 -->                        

<h2 id="redirecting-to-techdocs-archive-site" class="anchor"><a class="heading-anchor" href="#redirecting-to-techdocs-archive-site"><span></span></a>Redirecting to TechDocs archive site...</h2> 


                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div><!--/.col-sm-6-->
            </div>
            </section>
        </div>
    </section>    


<div class="modal fade" id="basicModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true" data-backdrop="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
					</div>
					<div class="modal-body">
						<div id="modalImg">
						
						</div>
					</div>
			</div>
		  </div>
		</div>
    <script>

    var new_domain = "zebra-techdocs-archive.netlify.app";
    var old_domain = window.location.host;
    var current_href = window.location.href;
    var new_href = current_href.replace(old_domain,new_domain);
    window.location = new_href;

    </script>
                                        
</div></body></html>